<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¹˜ë£Œì‹¤ íƒ€ì´ë¨¸ ë³´ë“œ</title>
  <style>
    :root {
      --purple: #4b0082;
      --yellow: #ffe08a;
      --red: #ff9e9e;
      --dept-rep: #ffd9a3;
      --dept-west: #b6dcff;
      --dept-1: #d7c7ff;
      --dept-2: #c7ffd6;
      --dept-3: #ffc7eb;
    }
    body {
      font-family: "Noto Sans KR", sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 100px 20px 60px 20px;
    }
    h2 { margin: 0 0 16px; }
    .toolbar {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 14px;
    }
    .toolbar input {
      padding: 6px 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 80px;
    }
    .btn {
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    .btn-apply { background: #007bff; color: #fff; }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    thead { background: var(--purple); color: #fff; }
    th, td {
      border: 1px solid #e5e5e5;
      padding: 10px 8px;
      text-align: center;
      font-size: 14px;
    }
    th:nth-child(1) { width: 120px; }
    th:nth-child(2) { width: 170px; text-align:left; }
    td:nth-child(2) { text-align:left; }

    .status-box {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      justify-content: center;
    }
    .pill {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
    }
    .pill-wait { background: #fff; border: 1.5px solid #ddd; }
    .pill-run  { background: var(--yellow); }
    .pill-done { background: #ff9e9e; }

    .mini-btn {
      border: none;
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .mini-start { background: #0d6efd; color: #fff; }
    .mini-stop  { background: #ffc107; }
    .time-text { font-weight: 700; color: #d9534f; font-size: 16px; }

    .adjust-box { display: flex; gap: 6px; }
    .btn-adjust {
      background: #fff;
      border: 1px solid #bbb;
      border-radius: 6px;
      width: 32px;
      height: 28px;
      line-height: 24px;
      text-align: center;
      cursor: pointer;
      font-size: 18px;
    }
    select.doctor {
      width: 130px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #bbb;
      font-size: 14px;
      background: #fff;
    }

    .nurse-panel {
      position: fixed;
      top: 12px;
      right: 12px;
      background: rgba(255,255,255,0.98);
      border: 2px solid #cfcfcf;
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: row;
      gap: 14px;
      align-items: center;
      z-index: 999;
    }
    .nurse-label {
      font-size: 16px;
      font-weight: 800;
      margin-right: 4px;
      white-space: nowrap;
    }
    .btn-call {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 15px;
      cursor: pointer;
      background: #f2f3f5;
      font-weight: 700;
      white-space: nowrap;
      letter-spacing: 0.2px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .btn-call.on {
      outline: 3px solid #ff4d4f;
      background: #ffe6e6;
    }

    @keyframes blinkRow {
      0% { filter: brightness(1); }
      50% { filter: brightness(1.45); }
      100% { filter: brightness(1); }
    }
    @keyframes blinkBtn {
      0% { background: #ffe6e6; transform: translateY(0); }
      50% { background: #ffb3b3; transform: translateY(-1px); }
      100% { background: #ffe6e6; transform: translateY(0); }
    }
    .blink-row { animation: blinkRow 0.8s linear infinite; }
    .blink-btn { animation: blinkBtn 0.7s ease-in-out infinite; }
  </style>
</head>
<body>

  <h2>ğŸ¥ ì¹˜ë£Œì‹¤ íƒ€ì´ë¨¸íŒ (12ë³‘ìƒ)</h2>

  <div class="toolbar">
    <span>ê¸°ë³¸ ì‹œê°„(ë¶„):</span>
    <input type="number" id="defaultMinutes" value="10" min="1" />
    <button class="btn btn-apply" onclick="applyDefaultMinutes()">ì ìš©</button>
    <small style="color:#666;">ì¶”ë‚˜ëŠ” 5ë¶„ ê³ ì • / ê° ì¹¸ì—ì„œ ï¼‹ï¼ë¡œ ì¡°ì •</small>
  </div>

  <table id="timerTable">
    <thead>
      <tr>
        <th>ë‹´ë‹¹</th>
        <th>í™˜ìì´ë¦„</th>
        <th>í•«íŒ©</th>
        <th>ë¬¼ë¦¬ì¹˜ë£Œ</th>
        <th>ì¹¨ì¹˜ë£Œ</th>
        <th>ì¶”ë‚˜</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="nurse-panel">
    <span class="nurse-label">ê°„í˜¸ì‚¬ í˜¸ì¶œ</span>
    <button class="btn-call" id="call-ëŒ€í‘œ" onclick="toggleCall('ëŒ€í‘œ')">ëŒ€í‘œ</button>
    <button class="btn-call" id="call-ì–‘ë°©" onclick="toggleCall('ì–‘ë°©')">ì–‘ë°©</button>
    <button class="btn-call" id="call-1ê³¼" onclick="toggleCall('1ê³¼')">1ê³¼</button>
    <button class="btn-call" id="call-2ê³¼" onclick="toggleCall('2ê³¼')">2ê³¼</button>
    <button class="btn-call" id="call-3ê³¼" onclick="toggleCall('3ê³¼')">3ê³¼</button>
  </div>

  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <script>
    let DEFAULT_MINUTES = 10;
    const ROW_COUNT = 12;
    const COLS = ["í•«íŒ©", "ë¬¼ë¦¬ì¹˜ë£Œ", "ì¹¨ì¹˜ë£Œ", "ì¶”ë‚˜"];
    const sound = document.getElementById("alarmSound");
    const timers = {};
    const blinkingDepts = new Set();
    const deptColors = {
      "": "",
      "ëŒ€í‘œ": "var(--dept-rep)",
      "ì–‘ë°©": "var(--dept-west)",
      "1ê³¼": "var(--dept-1)",
      "2ê³¼": "var(--dept-2)",
      "3ê³¼": "var(--dept-3)"
    };

    function buildTable() {
      const tbody = document.getElementById("tableBody");
      for (let i = 1; i <= ROW_COUNT; i++) {
        const tr = document.createElement("tr");
        tr.id = "row-" + i;

        const docTd = document.createElement("td");
        docTd.innerHTML = `
          <select class="doctor" onchange="changeDoctor(${i}, this.value)">
            <option value="">ì„ íƒ</option>
            <option value="ëŒ€í‘œ">ëŒ€í‘œ</option>
            <option value="ì–‘ë°©">ì–‘ë°©</option>
            <option value="1ê³¼">1ê³¼</option>
            <option value="2ê³¼">2ê³¼</option>
            <option value="3ê³¼">3ê³¼</option>
          </select>
        `;
        tr.appendChild(docTd);

        const nameTd = document.createElement("td");
        nameTd.textContent = i + "ë²ˆ í™˜ì";
        nameTd.contentEditable = true;
        tr.appendChild(nameTd);

        COLS.forEach((colName, colIndex) => {
          const td = document.createElement("td");
          const key = `r${i}_c${colIndex}`;
          td.innerHTML = `
            <div class="status-box" id="box-${key}">
              <span class="pill pill-wait" id="status-${key}">ëŒ€ê¸°</span>
              <span class="time-text" id="time-${key}"></span>
              <div class="adjust-box">
                <button class="btn-adjust" onclick="adjustTime('${key}', 1)">ï¼‹</button>
                <button class="btn-adjust" onclick="adjustTime('${key}', -1)">ï¼</button>
              </div>
              <div>
                <button class="mini-btn mini-start" onclick="startTimer('${key}', '${colName}')">ì§„í–‰</button>
                <button class="mini-btn mini-stop" onclick="stopTimer('${key}')">ì¤‘ì§€</button>
              </div>
            </div>
          `;
          tr.appendChild(td);
          timers[key] = { remaining: 0, duration: 0, running: false, intervalId: null, colName };
        });

        tbody.appendChild(tr);
      }
    }

    function changeDoctor(rowIndex, deptName) {
      const tr = document.getElementById("row-" + rowIndex);
      tr.style.background = deptColors[deptName] || "";
      if (deptName && blinkingDepts.has(deptName)) {
        tr.classList.add("blink-row");
      } else {
        tr.classList.remove("blink-row");
      }
    }

    function applyDefaultMinutes() {
      const v = parseInt(document.getElementById("defaultMinutes").value);
      if (!isNaN(v) && v > 0) {
        DEFAULT_MINUTES = v;
        alert("ê¸°ë³¸ ì‹œê°„ì´ " + v + "ë¶„ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    }

    function startTimer(key, colName) {
      const t = timers[key];
      if (!t.running) {
        const baseMinutes = (colName === "ì¶”ë‚˜") ? 5 : DEFAULT_MINUTES;
        if (t.remaining <= 0) {
          t.duration = baseMinutes * 60;
          t.remaining = t.duration;
        }
        t.running = true;
        updateStatus(key, "ì§„í–‰");
        runInterval(key);
      }
    }

    function stopTimer(key) {
      const t = timers[key];
      t.running = false;
      if (t.intervalId) {
        clearInterval(t.intervalId);
        t.intervalId = null;
      }
      updateStatus(key, "ëŒ€ê¸°");
      updateTimeText(key, "");
    }

    function adjustTime(key, diffMinutes) {
      const t = timers[key];
      const diffSec = diffMinutes * 60;
      if (!t.running && t.remaining <= 0) {
        const base = (t.colName === "ì¶”ë‚˜") ? 5 : DEFAULT_MINUTES;
        t.duration = base * 60;
        t.remaining = t.duration;
      }
      t.duration = Math.max(60, t.duration + diffSec);
      t.remaining = Math.max(60, (t.running ? t.remaining + diffSec : t.duration));
      updateTimeText(key, formatSec(t.remaining));
    }

    function runInterval(key) {
      const t = timers[key];
      if (t.intervalId) clearInterval(t.intervalId);
      t.intervalId = setInterval(() => {
        if (!t.running) return;
        t.remaining--;
        updateTimeText(key, formatSec(t.remaining));
        if (t.remaining <= 0) {
          clearInterval(t.intervalId);
          t.intervalId = null;
          t.running = false;
          updateStatus(key, "ì™„ë£Œ");
          updateTimeText(key, "");
          try { sound.play(); } catch (e) {}
          alert("âœ… " + key + " ì¹˜ë£Œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
      }, 1000);
    }

    function updateStatus(key, status) {
      const el = document.getElementById("status-" + key);
      if (!el) return;
      el.textContent = status;
      el.className = "pill";
      if (status === "ëŒ€ê¸°") el.classList.add("pill-wait");
      else if (status === "ì§„í–‰") el.classList.add("pill-run");
      else if (status === "ì™„ë£Œ") el.classList.add("pill-done");
    }

    function updateTimeText(key, text) {
      const el = document.getElementById("time-" + key);
      if (el) el.textContent = text;
    }

    function formatSec(sec) {
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    }

    function toggleCall(deptName) {
      const btn = document.getElementById("call-" + deptName);
      if (blinkingDepts.has(deptName)) {
        blinkingDepts.delete(deptName);
        btn.classList.remove("on");
        btn.classList.remove("blink-btn");
      } else {
        blinkingDepts.add(deptName);
        btn.classList.add("on");
        btn.classList.add("blink-btn");
      }
      for (let i = 1; i <= ROW_COUNT; i++) {
        const row = document.getElementById("row-" + i);
        const selectEl = row.querySelector("select.doctor");
        const currentDept = selectEl ? selectEl.value : "";
        if (currentDept && blinkingDepts.has(currentDept)) {
          row.classList.add("blink-row");
        } else {
          row.classList.remove("blink-row");
        }
      }
    }

    buildTable();
  </script>
</body>
</html>
